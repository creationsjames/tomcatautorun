<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apache Tomcat自動化背景執行手冊</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        
        code {
            font-family: 'JetBrains Mono', monospace;
        }

        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-x: auto;
            position: relative;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #334155;
            color: #94a3b8;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #475569;
        }

        .copy-btn:hover {
            background-color: #475569;
            color: #fff;
        }

        .step-number {
            background-color: #475569; 
            color: white;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            font-weight: bold;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        h2 {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body class="py-10 px-4 sm:px-6 lg:px-8">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden">
        
        <!-- Header -->
        <div class="bg-slate-600 px-8 py-10 text-white">
            <h1 class="text-3xl font-bold mb-2">Apache Tomcat自動化背景執行手冊</h1>
            <p class="text-slate-100">此份手冊以春生藥局MRP串LINE@為示範，實際各環境路徑、Service Name等等請視狀況修改。</p>
            <div class="mt-6 flex flex-wrap gap-4 text-sm text-slate-200">
                <span class="bg-slate-700 px-3 py-1 rounded-full">最後更新：2026/01/28</span>
            </div>
        </div>

        <div class="p-8 space-y-12">

            <!-- Environment Info -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">環境配置資訊</h2>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    <p class="text-sm text-yellow-800 font-semibold mb-2">請確認本機環境符合以下設定：</p>
                    <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                        <li><strong>Tomcat 路徑：</strong> <code class="bg-yellow-100 px-1 rounded text-red-600">D:\apache-tomcat-9.0.86</code></li>
                        <li><strong>服務名稱 (Service Name)：</strong> <code class="bg-yellow-100 px-1 rounded text-red-600">chunshengTomcat</code></li>
                        <li><strong>核心執行檔：</strong> <code class="bg-gray-100 px-1 rounded">tomcat9.exe</code></li>
                        <li><strong>管理介面檔：</strong> <code class="bg-gray-100 px-1 rounded">chunshengTomcatw.exe</code> (原名 tomcat9w.exe)</li>
                    </ul>
                </div>
            </section>

            <!-- Phase 1 -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <span class="step-number">1</span> 第一階段：環境建置與服務註冊
                </h2>
                <div class="space-y-8 ml-10">
                    
                    <!-- 1.1 -->
                    <div>
                        <h3 class="font-bold text-lg text-gray-700 mb-2">1.1 前置作業：補齊系統檔案</h3>
                        <p class="text-gray-600 mb-2">若使用 Core 版 Zip，<code class="text-sm bg-gray-100 px-1">bin</code> 資料夾可能缺少 Windows 服務檔案。請確認資料夾內包含：</p>
                        <ul class="list-disc list-inside text-gray-600 ml-4 mb-4 text-sm">
                            <li>service.bat</li>
                            <li>tomcat9.exe</li>
                            <li class="mb-1">tomcat9w.exe (請手動改名為 <strong>chunshengTomcatw.exe</strong>)</li>
                            <li class="list-none ml-[-1rem]">
                                <span class="bg-blue-50 text-blue-800 px-3 py-2 rounded text-sm block mt-2 border border-blue-200">
                                    <strong>※ 為什麼要改名？</strong><br>
                                    Windows 的 Tomcat 管理工具 (GUI) 是透過「檔名」來辨識要管理哪個服務。
                                    若您的服務名稱叫 <code>chunshengTomcat</code>，那管理工具的執行檔名就必須叫 <code>chunshengTomcatw.exe</code>，否則它打不開。
                                </span>
                            </li>
                        </ul>

                        <!-- 下載按鈕區塊 -->
                        <div class="mt-4 p-4 border border-slate-200 bg-slate-50 rounded-lg">
                            <h4 class="font-bold text-slate-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                相關檔案下載區
                            </h4>
                            
                            <div class="space-y-3">
                                <!-- 下載項目 1 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 hover:border-blue-400 transition-colors shadow-sm">
                                    <div class="flex items-center">
                                        <div class="bg-blue-100 p-2 rounded-lg mr-3">
                                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                        </div>
                                        <div>
                                            <h5 class="font-bold text-slate-800 text-sm">apache tomcat 需要補的程式 (.rar)</h5>
                                            <p class="text-xs text-slate-500">內含 service.bat, tomcat9.exe 等必要檔案</p>
                                        </div>
                                    </div>
                                    <a href="https://github.com/creationsjames/tomcatautorun/raw/refs/heads/main/apache%20tomcat%20%E9%9C%80%E8%A6%81%E8%A3%9C%E7%9A%84%E7%A8%8B%E5%BC%8F.rar" 
                                       target="_blank" 
                                       class="text-sm bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-colors whitespace-nowrap w-full sm:w-auto text-center">
                                        下載檔案
                                    </a>
                                </div>

                                <!-- 下載項目 2 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 hover:border-blue-400 transition-colors shadow-sm">
                                    <div class="flex items-center">
                                        <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                                            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                                        </div>
                                        <div>
                                            <h5 class="font-bold text-slate-800 text-sm">apache-tomcat-9.0.115-windows-x64 (.zip)</h5>
                                            <p class="text-xs text-slate-500">完整的 Windows 64位元 Tomcat 安裝包</p>
                                        </div>
                                    </div>
                                    <a href="https://github.com/creationsjames/tomcatautorun/raw/refs/heads/main/apache-tomcat-9.0.115-windows-x64.zip" 
                                       target="_blank" 
                                       class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded transition-colors whitespace-nowrap w-full sm:w-auto text-center">
                                        下載檔案
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 1.2 -->
                    <div>
                        <h3 class="font-bold text-lg text-gray-700 mb-2">1.2 安裝並註冊 Windows 服務</h3>
                        <p class="text-gray-600 mb-2">此步驟將 Tomcat 註冊進 Windows 系統服務中。完成後，<strong>每次電腦開機，Tomcat 就會自動在背景啟動執行</strong>，無需人工介入。</p>
                        <p class="text-gray-600 mb-2 text-sm">請以「系統管理員身分」開啟 CMD，執行以下指令：</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyToClipboard(this)">複製</button>
<pre>cd /d "D:\apache-tomcat-9.0.86\bin"
service.bat install chunshengTomcat</pre>
                        </div>
                        <div class="bg-blue-50 text-blue-800 px-3 py-2 rounded text-sm mt-2 border border-blue-200">
                            <strong>※ 命名說明：</strong> 指令中的 <code>chunshengTomcat</code> 是我們為此服務取的唯一名稱。後續所有的維護腳本、監控指令，都必須使用這個名字來呼叫它。
                        </div>
                        <p class="text-sm text-green-600 mt-2">✓ 成功訊號：CMD 顯示 "The service 'chunshengTomcat' has been installed."</p>
                    </div>

                    <!-- 1.3 -->
                    <div>
                        <h3 class="font-bold text-lg text-gray-700 mb-2">1.3 如何確認 Tomcat 是否正常執行？</h3>
                        <p class="text-gray-600 mb-3">由於服務是在背景執行 (沒有黑色視窗)，請透過以下任一方式確認狀態：</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="border p-4 rounded bg-white">
                                <h4 class="font-bold text-slate-700 mb-1">方式 A：瀏覽器測試 (最直覺)</h4>
                                <p class="text-sm text-gray-600">打開 Chrome/Edge，輸入網址 <code>http://localhost:8080</code>。<br>若看到 Tomcat 首頁或您的系統畫面，代表服務正常。</p>
                            </div>
                            <div class="border p-4 rounded bg-white">
                                <h4 class="font-bold text-slate-700 mb-1">方式 B：工作管理員</h4>
                                <p class="text-sm text-gray-600">按下 <code>Ctrl+Shift+Esc</code> 開啟工作管理員，切換到「服務」分頁，尋找名稱為 <code>chunshengTomcat</code> 的項目，狀態應顯示「執行中」。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phase 2 -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <span class="step-number">2</span> 第二階段：建立手動重啟腳本 (.bat)
                </h2>
                <p class="ml-10 text-gray-600 mb-6">雖然服務會自動執行，但當我們更新程式 (.class/.war) 或網站變慢時，需要手動重啟。為了省去開啟服務管理員的麻煩，請在桌面建立以下兩種腳本。</p>

                <div class="ml-10 grid gap-8">
                    
                    <!-- Script A -->
                    <div class="border rounded-lg p-5 bg-gray-50">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-lg text-slate-700">A. 一般重啟 (TomcatRestart.bat)</h3>
                            <span class="text-xs bg-slate-100 text-slate-800 px-2 py-1 rounded">建議圖示：藍/綠色</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">
                            <strong>用途：</strong> 標準的重啟流程。它會通知服務「請你停止」，等待停止後再啟動。<br>
                            <strong>時機：</strong> 日常更新程式、例行維護時使用。
                        </p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyToClipboard(this)">複製</button>
<pre>@echo off
:: [要求以系統管理員身分執行]
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"
if '%errorlevel%' NEQ '0' (
    echo 正在請求管理員權限...
    goto UACPrompt
) else ( goto gotAdmin )
:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B
:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"

echo 正在停止 chunshengTomcat 服務...
net stop chunshengTomcat
echo 等待 3 秒...
timeout /t 3 /nobreak >nul
echo 正在啟動 chunshengTomcat 服務...
net start chunshengTomcat
echo 服務重啟完成。
timeout /t 2 /nobreak >nul
exit</pre>
                        </div>
                    </div>

                    <!-- Script B -->
                    <div class="border rounded-lg p-5 bg-red-50 border-red-100">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-lg text-red-700">B. 強制重啟 (ForceRestart.bat)</h3>
                            <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">建議圖示：紅色警示</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">
                            <strong>用途：</strong> 當服務卡死、一般重啟無效（停不下來）時，直接強制殺除程序。<br>
                            <strong>時機：</strong> 網站當機、記憶體爆掉導致服務無回應時使用。
                        </p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyToClipboard(this)">複製</button>
<pre>@echo off
:: [要求以系統管理員身分執行]
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"
if '%errorlevel%' NEQ '0' (
    echo 正在請求管理員權限...
    goto UACPrompt
) else ( goto gotAdmin )
:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B
:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"

echo ==========================================
echo    緊急救援模式：強制重啟 chunshengTomcat
echo ==========================================
echo 1. 正在強制終止 Tomcat 核心程序...
taskkill /F /IM tomcat9.exe
echo 等待 3 秒...
timeout /t 3 /nobreak >nul
echo 2. 正在啟動 chunshengTomcat 服務...
net start chunshengTomcat
echo 重啟完成。
timeout /t 3 /nobreak >nul
exit</pre>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Phase 3 -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <span class="step-number">3</span> 第三階段：建立設定介面腳本
                </h2>
                <div class="ml-10">
                    <p class="text-gray-600 mb-4">此腳本並非用來重啟服務，而是用來開啟 Tomcat 的圖形化設定視窗 (GUI)。</p>
                    
                    <div class="border rounded-lg p-5 bg-white mb-6">
                        <h3 class="font-bold text-lg text-gray-700 mb-2">ConfigTomcat.bat</h3>
                        
                        <!-- 示意圖區域 -->
                        <div class="mb-4 text-center">
                            <!-- 請將使用者截圖命名為 tomcat_properties.png 並放在同目錄 -->
                            <!-- 修改：加入 w-1/2 mx-auto cursor-zoom-in 等樣式，並綁定 onclick 事件 -->
                            <img src="tomcat_properties.png" 
                                 onerror="this.src='https://placehold.co/600x400/f1f5f9/475569.png?text=請將您的截圖命名為+tomcat_properties.png+並放在同目錄'"
                                 alt="Tomcat 設定介面示意圖" 
                                 class="w-1/2 mx-auto rounded shadow border border-gray-200 cursor-zoom-in hover:opacity-95 transition-opacity"
                                 onclick="openImageModal(this.src)"
                                 title="點擊放大瀏覽" />
                            <p class="text-xs text-center text-gray-500 mt-2">
                                示意圖：開啟後的畫面 (General 分頁) - <span class="text-blue-600 cursor-pointer hover:underline" onclick="openImageModal(document.querySelector('img[alt=\'Tomcat 設定介面示意圖\']').src)">點擊圖片放大</span>。<br>
                                <span class="text-red-500 font-bold">注意：</span>請點選上方的 <strong>「Java」</strong> 分頁來設定 Initial/Maximum Memory Pool (記憶體池)。
                            </p>
                        </div>

                        <p class="text-sm text-gray-600 mb-3">
                            <strong>為什麼需要它？</strong><br>
                            預設的 Tomcat 記憶體配置較小。若您的 MRP 系統處理大量資料，可能會發生 <code>OutOfMemoryError</code>。透過此腳本開啟介面，您可以調整 Java Memory Pool (Initial/Maximum) 的大小，提升系統穩定度。
                        </p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyToClipboard(this)">複製</button>
<pre>@echo off
:: [要求以系統管理員身分執行]
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"
if '%errorlevel%' NEQ '0' (
    echo 正在請求管理員權限...
    goto UACPrompt
) else ( goto gotAdmin )
:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B
:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"

echo 正在開啟設定介面...
cd /d "D:\apache-tomcat-9.0.86\bin"
start chunshengTomcatw.exe //ES//chunshengTomcat
exit</pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phase 4 -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <span class="step-number">4</span> 第四階段：設定 Windows 工作排程
                </h2>
                <div class="ml-10">
                    <div class="bg-indigo-50 border-l-4 border-indigo-400 p-4 mb-6">
                        <h3 class="font-bold text-indigo-800 text-sm mb-1">為什麼需要設定工作排程 (Task Scheduler)？</h3>
                        <p class="text-sm text-indigo-900">
                            雖然 Tomcat 會自動執行，但長時間運作下來（例如連續跑一個月），Java 程式可能會因為累積過多的記憶體暫存無法釋放，導致網站變慢甚至當機 (Hang)。<br>
                            為了預防這種情況，建議設定<strong>「Windows 工作排程」</strong>，讓系統在每天半夜 (如 04:00) 自動執行一次重啟，確保每天早上的系統都是最乾淨、效能最好的狀態。
                        </p>
                    </div>

                    <p class="text-gray-600 mb-4">請建立一個一次性的設定腳本 <code class="text-sm bg-gray-100 px-1">SetupAutoRestart.bat</code> 並執行。它會自動在 Windows 排程器中新增一個每日任務。</p>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyToClipboard(this)">複製</button>
<pre>@echo off
:: [要求以系統管理員身分執行]
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"
if '%errorlevel%' NEQ '0' (
    goto UACPrompt
) else ( goto gotAdmin )
:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    del "%temp%\getadmin.vbs"
    exit /B
:gotAdmin
    pushd "%CD%"
    CD /D "%~dp0"

set TARGET_DIR=D:\apache-tomcat-9.0.86\bin
set RESTART_SCRIPT=%TARGET_DIR%\DailyRestart.bat

:: 步驟 1: 在 bin 資料夾內產生專用的重啟腳本 (含Log紀錄)
(
echo @echo off
echo echo [Auto-Restart] %%date%% %%time%% 正在執行排程重啟... ^>^> "%TARGET_DIR%\restart_log.txt"
echo net stop chunshengTomcat
echo timeout /t 5 /nobreak ^>nul
echo taskkill /F /IM tomcat9.exe ^>nul 2^>^&1
echo timeout /t 3 /nobreak ^>nul
echo net start chunshengTomcat
echo echo [Auto-Restart] 重啟完成 ^>^> "%TARGET_DIR%\restart_log.txt"
) > "%RESTART_SCRIPT%"

:: 步驟 2: 註冊 Windows 排程 (每日 04:00 以 SYSTEM 權限執行)
schtasks /create /tn "TomcatDailyRestart" /tr "'%RESTART_SCRIPT%'" /sc daily /st 04:00 /ru SYSTEM /rl HIGHEST /f
echo 設定完成。排程名稱: TomcatDailyRestart
pause</pre>
                    </div>
                </div>
            </section>

            <!-- Troubleshooting -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-t pt-8">常見問題排除 (Troubleshooting)</h2>
                <div class="overflow-hidden border rounded-lg shadow-sm">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">問題現象</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">檢查方式</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">解決方案</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap font-medium text-red-600">網頁無法開啟</td>
                                <td class="px-6 py-4 text-gray-600">瀏覽器無法連線至 localhost:8080</td>
                                <td class="px-6 py-4 text-gray-600">使用 <strong>TomcatRestart.bat</strong> 重啟服務。</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap font-medium text-red-600">重啟腳本卡住</td>
                                <td class="px-6 py-4 text-gray-600">視窗停在「正在停止服務...」很久</td>
                                <td class="px-6 py-4 text-gray-600">關閉視窗，改用 <strong>ForceRestart.bat</strong> 強制重啟。</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap font-medium text-red-600">Config 介面打不開</td>
                                <td class="px-6 py-4 text-gray-600">執行 ConfigTomcat.bat 沒反應</td>
                                <td class="px-6 py-4 text-gray-600">檢查 bin 資料夾內是否有 <code>chunshengTomcatw.exe</code> (需改名)。</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
        
        <div class="bg-gray-800 text-gray-400 py-6 px-8 text-center text-sm">
            2026 James Peng 製作, 僅供專業技術人員閱讀
        </div>

    </div>

    <!-- Image Modal (Lightbox) -->
    <div id="imageModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-90 flex items-center justify-center p-4 cursor-zoom-out" onclick="closeImageModal()">
        <div class="relative max-w-full max-h-full" onclick="event.stopPropagation()">
            <!-- Image container -->
            <img id="modalImage" src="" alt="Full size" class="max-h-[90vh] max-w-[90vw] object-contain rounded shadow-2xl">
            
            <!-- Close button -->
            <button class="absolute -top-10 right-0 text-white hover:text-gray-300 focus:outline-none" onclick="closeImageModal()">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <p class="text-white text-center mt-2 text-sm opacity-80">點擊背景或按 Esc 關閉</p>
        </div>
    </div>

    <script>
        function copyToClipboard(button) {
            const pre = button.nextElementSibling;
            const text = pre.innerText;
            
            // Create temporary textarea to copy text
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                const originalText = button.innerText;
                button.innerText = '已複製！';
                button.classList.add('bg-green-600', 'text-white', 'border-green-700');
                
                setTimeout(() => {
                    button.innerText = originalText;
                    button.classList.remove('bg-green-600', 'text-white', 'border-green-700');
                }, 2000);
            } catch (err) {
                console.error('複製失敗', err);
                button.innerText = '失敗';
            }
            
            document.body.removeChild(textarea);
        }

        // Lightbox functions
        function openImageModal(src) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modalImg.src = src;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
        }

        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeImageModal();
            }
        });
    </script>
</body>
</html>
